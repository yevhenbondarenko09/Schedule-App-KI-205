<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–†–æ–∑–∫–ª–∞–¥ –ö–Ü-205</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #2E365A;
            --secondary-color: #6C5E82;
            --accent-pink: #E0797F;
            --soft-blue: #96A4C5;
            --card-bg: #3B446B;
            --text-main: #FFFFFF;
            --text-muted: #B0BCD5;
            --success: #6CAE82;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            min-height: 100vh;
            padding-bottom: 60px; /* Increased bottom padding */
        }

        /* --- Header & Controls --- */
        header {
            background-color: rgba(46, 54, 90, 0.98);
            padding: 20px 20px 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(150, 164, 197, 0.15);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .current-time {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-main);
        }

        .date-info {
            font-size: 0.85rem;
            color: var(--soft-blue);
            text-align: right;
            line-height: 1.4;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        /* --- Toggles --- */
        .toggle-container {
            background: rgba(0,0,0,0.25);
            border-radius: 50px;
            padding: 4px;
            display: flex;
        }

        .toggle-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--soft-blue);
            padding: 10px 0; /* Slightly larger touch target */
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.25s ease;
            text-align: center;
        }

        .toggle-btn.active {
            background-color: var(--secondary-color);
            color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .toggle-btn.subgroup-active {
            background-color: var(--accent-pink);
            color: white;
            box-shadow: 0 2px 8px rgba(224, 121, 127, 0.3);
        }

        /* --- Schedule List --- */
        .container {
            padding: 10px 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Task 2: Improved Visual Day Separation */
        .day-card {
            margin-top: 40px; /* Critical Fix: Adds breathing room between days */
            animation: fadeIn 0.5s ease;
        }

        /* Remove margin from the very first day to sit nice under header */
        .day-card:first-child {
            margin-top: 20px;
        }

        .day-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            padding-left: 12px;
            border-left: 5px solid var(--soft-blue);
        }

        .day-header h2 {
            font-size: 1.4rem; /* Critical Fix: Larger font */
            font-weight: 800;  /* Critical Fix: Bolder font */
            margin-right: 12px;
            color: var(--text-main);
            letter-spacing: -0.5px;
        }

        .day-header.is-today h2 {
            color: var(--accent-pink);
        }
        
        .day-header.is-today {
            border-left-color: var(--accent-pink);
        }

        .label-today {
            font-size: 0.75rem;
            background: var(--accent-pink);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* --- Lesson Card Styles --- */
        .lesson-card {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 18px; /* Slightly more padding */
            margin-bottom: 14px;
            border: 1px solid rgba(150, 164, 197, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            /* Layout is now flow-based, not absolute */
        }

        .lesson-card:active {
            transform: scale(0.98);
        }

        /* Task 1: Fix Text Overlap via Flexbox */
        .lesson-header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start; /* Aligns top so multi-line text doesn't center the time */
            gap: 15px; /* Minimum space between text and time */
            margin-bottom: 10px;
        }

        .lesson-subject {
            font-size: 1.05rem;
            font-weight: 700;
            line-height: 1.35;
            color: var(--text-main);
            
            /* Critical Fix: Handling overflow flex-item behavior */
            flex: 1;        /* Take up remaining space */
            min-width: 0;   /* Allow shrinking below content size if needed */
            
            /* Truncate nicely with ellipsis on 2nd line if needed */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .lesson-time {
            /* Critical Fix: Prevent time from shrinking or wrapping */
            flex-shrink: 0;
            white-space: nowrap;
            
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--soft-blue);
            background: rgba(0,0,0,0.25);
            padding: 6px 12px;
            border-radius: 12px;
            height: fit-content;
        }

        .tags {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .tag {
            font-size: 0.7rem;
            padding: 4px 10px;
            border-radius: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tag.lecture { background-color: rgba(108, 94, 130, 0.3); color: #C4B5D6; border: 1px solid var(--secondary-color); }
        .tag.lab { background-color: rgba(224, 121, 127, 0.2); color: var(--accent-pink); border: 1px solid var(--accent-pink); }
        .tag.practical { background-color: rgba(108, 174, 130, 0.2); color: var(--success); border: 1px solid var(--success); }
        .tag.room { background: rgba(150, 164, 197, 0.15); border: 1px solid var(--soft-blue); color: var(--soft-blue); }

        .lesson-details {
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 0.9rem;
            color: var(--text-muted);
            border-top: 1px solid rgba(255,255,255,0.05);
            padding-top: 10px;
        }

        .detail-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-icon { opacity: 0.7; font-size: 1.1em; }

        /* Free Window State */
        .free-window {
            background-color: transparent;
            border: 2px dashed rgba(150, 164, 197, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            color: var(--text-muted);
            font-style: italic;
        }

        /* Utilities */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header>
        <div class="top-bar">
            <div class="current-time" id="clock">00:00</div>
            <div class="date-info">
                <div id="current-date">...</div>
                <div style="font-weight:700; color: var(--accent-pink); margin-top: 2px;" id="week-indicator">...</div>
            </div>
        </div>

        <div class="controls-grid">
            <!-- Week Toggle -->
            <div class="toggle-container">
                <button class="toggle-btn" id="btn-numerator" onclick="setWeekType('numerator')">–ß–∏—Å–µ–ª—å–Ω–∏–∫</button>
                <button class="toggle-btn" id="btn-denominator" onclick="setWeekType('denominator')">–ó–Ω–∞–º–µ–Ω–Ω–∏–∫</button>
            </div>

            <!-- Subgroup Toggle -->
            <div class="toggle-container">
                <button class="toggle-btn" id="btn-sub1" onclick="setSubgroup(1)">–ü—ñ–¥–≥—Ä—É–ø–∞ 1</button>
                <button class="toggle-btn" id="btn-sub2" onclick="setSubgroup(2)">–ü—ñ–¥–≥—Ä—É–ø–∞ 2</button>
            </div>
        </div>
    </header>

    <main class="container" id="schedule-container">
        <!-- Content injected by JS -->
    </main>

    <script>
        // --- 1. CONFIGURATION & DATA ---
        const SEMESTER_START = new Date("2026-02-09T00:00:00"); 
        
        const scheduleData = [
          {
            day: "–ü–æ–Ω–µ–¥—ñ–ª–æ–∫",
            lessons: [
              {
                id: 1, time: "08:30 - 09:50", items: [
                  { subject: "–ê–ª–≥–æ—Ä–∏—Ç–º–∏ —Ç–∞ –º–æ–¥–µ–ª—ñ –æ–±—á–∏—Å–ª–µ–Ω—å", type: "Lab", teacher: "–°—î—á–∫–æ –û.–Ü.", room: "905 V –Ω.–∫.", subgroup: 1, week: "both" },
                  { subject: "–ú–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–∏—Ö —Å–∏—Å—Ç–µ–º", type: "Lab", teacher: "–ë—É–¥–∑ –Ü.–°.", room: "907 V –Ω.–∫.", subgroup: 2, week: "both" }
                ]
              },
              {
                id: 2, time: "10:05 - 11:25", items: [
                  { subject: "–ê–ª–≥–æ—Ä–∏—Ç–º–∏ —Ç–∞ –º–æ–¥–µ–ª—ñ –æ–±—á–∏—Å–ª–µ–Ω—å", type: "Lab", teacher: "–°—î—á–∫–æ –û.–Ü.", room: "905 V –Ω.–∫.", subgroup: 2, week: "both" }
                ]
              },
              {
                id: 3, time: "11:40 - 13:00", items: [
                  { subject: "–§—ñ–ª–æ—Å–æ—Ñ—ñ—è", type: "Lecture", teacher: "–ß—É—Ä—Å—ñ–Ω–æ–≤–∞ –û.–Æ.", room: "411 I –Ω.–∫.", subgroup: "both", week: "both" }
                ]
              },
              {
                id: 4, time: "13:15 - 14:35", items: [
                  { subject: "–ú–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–∏—Ö —Å–∏—Å—Ç–µ–º", type: "Lab", teacher: "–ë—É–¥–∑ –Ü.–°.", room: "907 V –Ω.–∫.", subgroup: 1, week: "both" }
                ]
              }
            ]
          },
          {
            day: "–í—ñ–≤—Ç–æ—Ä–æ–∫",
            lessons: [
              {
                id: 1, time: "08:30 - 09:50", items: [
                  { subject: "–°–∏—Å—Ç–µ–º–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, —á–∞—Å—Ç–∏–Ω–∞ 1", type: "Lecture", teacher: "–ü—É–π–¥–∞ –î.–í.", room: "512 V –Ω.–∫.", subgroup: "both", week: "both" }
                ]
              },
              {
                id: 2, time: "10:05 - 11:25", items: [
                  { subject: "–û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –±–∞–∑ –¥–∞–Ω–∏—Ö", type: "Lecture", teacher: "–ö–æ–ª–æ–¥—á–∞–∫ –û.–ú.", room: "906 V –Ω.–∫.", subgroup: "both", week: "both" }
                ]
              },
              {
                id: 3, time: "11:40 - 13:00", items: [
                  { subject: "–§—ñ–ª–æ—Å–æ—Ñ—ñ—è", type: "Practical", teacher: "–ü–∞–Ω—å–∫–æ –û.–Ü.", room: "902 V –Ω.–∫.", subgroup: "both", week: "both" }
                ]
              }
            ]
          },
          {
            day: "–°–µ—Ä–µ–¥–∞",
            lessons: [
              {
                id: 1, time: "08:30 - 09:50", items: [
                  { subject: "–ú–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–∏—Ö —Å–∏—Å—Ç–µ–º", type: "Lecture", teacher: "–ë—É–¥–∑ –Ü.–°.", room: "906 V –Ω.–∫.", subgroup: "both", week: "both" }
                ]
              },
              {
                id: 2, time: "10:05 - 11:25", items: [
                  { subject: "–°–∏—Å—Ç–µ–º–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, —á–∞—Å—Ç–∏–Ω–∞ 1", type: "Lab", teacher: "–ú–∞–∫—Å–∏–º—ñ–≤ –ú.–†.", room: "505a2 V –Ω.–∫.", subgroup: 1, week: "numerator" },
                  { subject: "–°–∏—Å—Ç–µ–º–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, —á–∞—Å—Ç–∏–Ω–∞ 1", type: "Lab", teacher: "–ú–∞–∫—Å–∏–º—ñ–≤ –ú.–†.", room: "505a2 V –Ω.–∫.", subgroup: 2, week: "denominator" }
                ]
              }
            ]
          },
          {
            day: "–ß–µ—Ç–≤–µ—Ä",
            lessons: [
              {
                id: 1, time: "08:30 - 09:50", items: [
                  { subject: "–ê–ª–≥–æ—Ä–∏—Ç–º–∏ —Ç–∞ –º–æ–¥–µ–ª—ñ –æ–±—á–∏—Å–ª–µ–Ω—å", type: "Lecture", teacher: "–ö–æ–ª–æ–¥—ñ–π –ó.–û.", room: "906 V –Ω.–∫.", subgroup: "both", week: "both" }
                ]
              },
              {
                id: 2, time: "10:05 - 11:25", items: [
                  { subject: "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∞ —Å—Ö–µ–º–æ—Ç–µ—Ö–Ω—ñ–∫–∞", type: "Lab", teacher: "–ß–µ—Ä—á–∏–∫ –ì.–¢.", room: "509 V –Ω.–∫.", subgroup: 1, week: "both" },
                  { subject: "–û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –±–∞–∑ –¥–∞–Ω–∏—Ö", type: "Lab", teacher: "–Ü–≤–∞–Ω–æ–≤ –Æ.–°.", room: "505a2 V –Ω.–∫.", subgroup: 2, week: "both" }
                ]
              },
              {
                id: 3, time: "11:40 - 13:00", items: [
                  { subject: "–û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –±–∞–∑ –¥–∞–Ω–∏—Ö", type: "Lab", teacher: "–Ü–≤–∞–Ω–æ–≤ –Æ.–°.", room: "505a2 V –Ω.–∫.", subgroup: 1, week: "both" },
                  { subject: "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∞ —Å—Ö–µ–º–æ—Ç–µ—Ö–Ω—ñ–∫–∞", type: "Lab", teacher: "–ß–µ—Ä—á–∏–∫ –ì.–¢.", room: "509 V –Ω.–∫.", subgroup: 2, week: "both" }
                ]
              }
            ]
          },
          {
            day: "–ü'—è—Ç–Ω–∏—Ü—è",
            lessons: [
              {
                id: 2, time: "10:05 - 11:25", items: [
                  { subject: "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∞ —Å—Ö–µ–º–æ—Ç–µ—Ö–Ω—ñ–∫–∞", type: "Practical", teacher: "–ß–µ—Ä—á–∏–∫ –ì.–¢.", room: "902 V –Ω.–∫.", subgroup: "both", week: "numerator" },
                  { subject: "–°–∏—Å—Ç–µ–º–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, —á–∞—Å—Ç–∏–Ω–∞ 1", type: "Practical", teacher: "–ú–∞–∫—Å–∏–º—ñ–≤ –ú.–†.", room: "902 V –Ω.–∫.", subgroup: "both", week: "denominator" }
                ]
              },
              {
                id: 3, time: "11:40 - 13:00", items: [
                  { subject: "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∞ —Å—Ö–µ–º–æ—Ç–µ—Ö–Ω—ñ–∫–∞", type: "Lecture", teacher: "–ü–∞—Ä–∞–ª—é—Ö –Ü.–ü., –ö–ª—É—à–∏–Ω –Æ.–°.", room: "512 V –Ω.–∫.", subgroup: "both", week: "both" }
                ]
              }
            ]
          }
        ];

        // --- 2. STATE MANAGEMENT ---
        const state = {
            weekType: 'numerator', 
            subgroup: 1 
        };

        // --- 3. LOGIC ---

        function init() {
            const autoWeek = calculateWeekType();
            state.weekType = autoWeek;

            const savedSubgroup = localStorage.getItem('ki205_subgroup');
            if (savedSubgroup) {
                state.subgroup = parseInt(savedSubgroup);
            }

            updateTime();
            setInterval(updateTime, 1000);
            updateUI();
        }

        function calculateWeekType() {
            const now = new Date();
            const start = new Date(SEMESTER_START);
            start.setHours(0,0,0,0);
            const current = new Date(now);
            current.setHours(0,0,0,0);

            const diffTime = current - start;
            if(diffTime < 0) return 'numerator'; 

            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const weekNumber = Math.floor(diffDays / 7);

            return (weekNumber % 2 === 0) ? 'numerator' : 'denominator';
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('clock').innerText = timeString;

            const options = { weekday: 'long', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString('uk-UA', options);
            document.getElementById('current-date').innerText = dateString.charAt(0).toUpperCase() + dateString.slice(1);
        }

        function setSubgroup(val) {
            state.subgroup = val;
            localStorage.setItem('ki205_subgroup', val);
            updateUI();
        }

        function setWeekType(val) {
            state.weekType = val;
            updateUI();
        }

        function updateUI() {
            document.getElementById('btn-numerator').className = `toggle-btn ${state.weekType === 'numerator' ? 'active' : ''}`;
            document.getElementById('btn-denominator').className = `toggle-btn ${state.weekType === 'denominator' ? 'active' : ''}`;
            
            document.getElementById('btn-sub1').className = `toggle-btn ${state.subgroup === 1 ? 'subgroup-active' : ''}`;
            document.getElementById('btn-sub2').className = `toggle-btn ${state.subgroup === 2 ? 'subgroup-active' : ''}`;

            document.getElementById('week-indicator').innerText = state.weekType === 'numerator' ? '–ß–∏—Å–µ–ª—å–Ω–∏–∫' : '–ó–Ω–∞–º–µ–Ω–Ω–∏–∫';

            renderSchedule();
        }

        function getDayIndex(dayName) {
            const map = { "–ü–æ–Ω–µ–¥—ñ–ª–æ–∫": 1, "–í—ñ–≤—Ç–æ—Ä–æ–∫": 2, "–°–µ—Ä–µ–¥–∞": 3, "–ß–µ—Ç–≤–µ—Ä": 4, "–ü'—è—Ç–Ω–∏—Ü—è": 5 };
            return map[dayName] || 0;
        }

        function renderSchedule() {
            const container = document.getElementById('schedule-container');
            container.innerHTML = '';

            const currentDayIndex = new Date().getDay(); 

            scheduleData.forEach(dayData => {
                const dayIndex = getDayIndex(dayData.day);
                const isToday = dayIndex === currentDayIndex;

                const dayWrapper = document.createElement('div');
                dayWrapper.className = 'day-card';
                
                const headerHtml = `
                    <div class="day-header ${isToday ? 'is-today' : ''}">
                        <h2>${dayData.day}</h2>
                        ${isToday ? '<span class="label-today">–°—å–æ–≥–æ–¥–Ω—ñ</span>' : ''}
                    </div>
                `;
                dayWrapper.innerHTML = headerHtml;

                let hasLessonsForSomeone = false;

                dayData.lessons.forEach(lessonSlot => {
                    const myLesson = lessonSlot.items.find(item => 
                        (item.week === 'both' || item.week === state.weekType) && 
                        (item.subgroup === 'both' || item.subgroup === state.subgroup)
                    );

                    const anyLessonAtAll = lessonSlot.items.length > 0;

                    if (myLesson) {
                        hasLessonsForSomeone = true;
                        dayWrapper.innerHTML += createLessonCard(myLesson, lessonSlot.time);
                    } else if (anyLessonAtAll) {
                        const otherLesson = lessonSlot.items.find(item => 
                           (item.week === 'both' || item.week === state.weekType) && 
                           (item.subgroup !== 'both' && item.subgroup !== state.subgroup)
                        );
                        
                        if(otherLesson) {
                             hasLessonsForSomeone = true;
                             dayWrapper.innerHTML += `
                                <div class="lesson-card free-window">
                                    <span>–í—ñ–∫–Ω–æ (${lessonSlot.time})</span>
                                </div>
                             `;
                        }
                    }
                });

                if (hasLessonsForSomeone) {
                    container.appendChild(dayWrapper);
                }
            });
        }

        function createLessonCard(item, time) {
            let typeClass = '';
            if(item.type.includes('Lab')) typeClass = 'lab';
            else if(item.type.includes('Lecture')) typeClass = 'lecture';
            else typeClass = 'practical';

            let typeLabel = item.type;
            if(typeLabel === 'Lab') typeLabel = '–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞';
            if(typeLabel === 'Lecture') typeLabel = '–õ–µ–∫—Ü—ñ—è';
            if(typeLabel === 'Practical') typeLabel = '–ü—Ä–∞–∫—Ç–∏—á–Ω–∞';

            // Updated HTML structure for Flexbox layout
            return `
                <div class="lesson-card">
                    <div class="lesson-header-row">
                        <div class="lesson-subject">${item.subject}</div>
                        <div class="lesson-time">${time}</div>
                    </div>
                    
                    <div class="tags">
                        <span class="tag ${typeClass}">${typeLabel}</span>
                        <span class="tag room">${item.room}</span>
                    </div>

                    <div class="lesson-details">
                        <div class="detail-row">
                            <span class="detail-icon">üéì</span>
                            <span>${item.teacher}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        init();

    </script>
</body>
</html>